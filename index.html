<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure Password Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    .theme-switcher {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
    }

    body[data-theme="midnight"] {
        --bg: #0d1117;
        --card: #161b22;
        --accent: #58a6ff;
        --text: #c9d1d9;
        --muted: #8b949e;
        --card-border: #30363d;
        --input-bg: #0d1117;
    }

    body[data-theme="matrix"] {
        --bg: #000000;
        --card: #0d0d0d;
        --accent: #39ff14;
        --text: #ffffff;
        --muted: #888888;
        --card-border: #333333;
        --input-bg: #000000;
    }

    body[data-theme="daylight"] {
        --bg: #ffffff;
        --card: #f6f8fa;
        --accent: #0969da;
        --text: #24292f;
        --muted: #57606a;
        --card-border: #d0d7de;
        --input-bg: #ffffff;
    }
</style>
<style>
:root {
  /* Default Theme: Midnight */
  --bg: #0d1117;
  --card: #161b22;
  --accent: #58a6ff;
  --ok: #2ecc71;
  --warn: #f1c40f;
  --bad: #e74c3c;
  --text: #c9d1d9;
  --muted: #8b949e;
  --card-border: #30363d;
  --input-bg: #0d1117;
}

* { 
    box-sizing: border-box; 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji"; 
}

body { 
    margin: 0; 
    padding: 40px; 
    background: var(--bg); 
    color: var(--text);
    transition: background 0.3s, color 0.3s;
}

h1 {
    text-align: center;
    margin-bottom: 40px;
    font-weight: 600;
}

.card { 
    background: var(--card); 
    border-radius: 6px; 
    padding: 24px; 
    margin: 0 auto 24px auto;
    max-width: 600px;
    border: 1px solid var(--card-border);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.row { 
    display: flex; 
    gap: 16px; 
    flex-wrap: wrap; 
    align-items: center; 
}

button {
  background: var(--accent);
  border: 1px solid var(--accent);
  padding: 10px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  color: var(--bg);
  transition: background 0.2s, color 0.2s, border-color 0.2s;
}

button:hover {
    background: transparent;
    color: var(--accent);
}

button.secondary { 
    background: var(--card); 
    color: var(--text);
    border: 1px solid var(--card-border);
}

button.secondary:hover { 
    background: var(--bg);
    border-color: var(--accent);
}


.toggle {
  background: var(--input-bg);
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  user-select: none;
  border: 1px solid var(--card-border);
}
.toggle.active { 
    background: var(--accent); 
    color: var(--bg);
    border-color: var(--accent);
}

.output {
  background: var(--input-bg);
  padding: 16px;
  border-radius: 6px;
  font-family: "SF Mono", "Fira Code", "Fira Mono", "Roboto Mono", monospace;
  word-break: break-all;
  min-height: 54px;
  display: flex;
  align-items: center;
  border: 1px solid var(--card-border);
}

.meter { 
    height: 8px; 
    background: var(--input-bg); 
    border-radius: 4px; 
    overflow: hidden; 
    margin-top: 10px; 
    border: 1px solid var(--card-border);
}
.meter div { 
    height: 100%; 
    width: 0%; 
    transition: width 0.3s; 
}

.small { 
    font-size: 0.8em; 
    color: var(--muted); 
    margin-top: 4px;
    display: block;
}

table { 
    width: 100%; 
    border-collapse: collapse; 
    font-size: 0.9em; 
}
td, th { 
    border-bottom: 1px solid var(--card-border); 
    padding: 12px 8px; 
    text-align: left; 
}
th { 
    font-weight: 600;
    color: var(--muted);
}

input[type="range"] {
    -webkit-appearance: none;
    width: 180px;
    height: 8px;
    background: var(--input-bg);
    border-radius: 4px;
    border: 1px solid var(--card-border);
    outline: none;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: var(--accent);
    cursor: pointer;
    border-radius: 50%;
}

input[type="number"] {
    width: 80px;
    background: var(--input-bg);
    color: var(--text);
    border: 1px solid var(--card-border);
    padding: 8px;
    border-radius: 6px;
}

footer {
    text-align: center;
    padding: 40px 20px;
    color: var(--muted);
    font-size: 0.9em;
}

footer a {
    color: var(--accent);
    text-decoration: none;
}
footer a:hover {
    text-decoration: underline;
}
</style>
</head>

<body>

<div class="theme-switcher">
    <button data-theme="midnight">Midnight</button>
    <button data-theme="matrix">Matrix</button>
    <button data-theme="daylight">Daylight</button>
</div>

<h1>üîê Secure Password Generator</h1>

<div class="card">
    <div class="row">
        <label for="length">Password Length: <strong id="lenVal">16</strong></label>
        <input id="length" type="range" min="8" max="64" value="16" style="width: 180px;">
    </div>

  <div class="row" style="margin-top:10px">
    <div class="toggle active" data-set="upper">A-Z</div>
    <div class="toggle active" data-set="lower">a-z</div>
    <div class="toggle active" data-set="numbers">0-9</div>
    <div class="toggle active" data-set="symbols">!@#</div>
  </div>

  <div class="output" id="passwordOutput" style="margin-top: 20px;"></div>

    <div style="margin-top:10px">
        <div class="meter"><div id="strengthBar"></div></div>
        <div class="small" id="strengthInfo"></div>
    </div>


  <div class="row" style="margin-top:20px">
    <button id="generateBtn">Generate</button>
    <button class="secondary" id="copyBtn">Copy</button>
    <button class="secondary" id="saveBtn">Save</button>
  </div>

</div>

<div class="card">
  <h3>Batch Generation</h3>
  <div class="row">
    <input id="batchCount" type="number" min="1" max="50" value="5" style="width: 80px;">
    <button id="batchBtn">Generate Batch</button>
    <button class="secondary" id="exportBtn">Export Vault</button>
  </div>
  <div id="batchOutput" class="output" style="margin-top:10px; min-height: 100px; align-items: flex-start;"></div>
</div>

<div class="card">
  <h3>Password History</h3>
  <table id="history">
    <tr><th>Timestamp</th><th>Password</th></tr>
  </table>
</div>

<footer>
    Created by <a href="https://github.com/artanphn-dotcom" target="_blank">Artan.V</a>
</footer>

<script>
/* ======================
   THEME SWITCHER
====================== */
const themeSwitcher = document.querySelector('.theme-switcher');
themeSwitcher.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON') {
        const theme = e.target.dataset.theme;
        document.body.dataset.theme = theme;
        saveTheme(theme);
    }
});

function saveTheme(theme) {
    localStorage.setItem('theme', theme);
}

function loadTheme() {
    const theme = localStorage.getItem('theme');
    if (theme) {
        document.body.dataset.theme = theme;
    }
}

/* ======================
   DOM REFERENCES
====================== */
const lengthInput = document.getElementById("length");
const lenVal = document.getElementById("lenVal");
const passwordOutput = document.getElementById("passwordOutput");
const strengthBar = document.getElementById("strengthBar");
const strengthInfo = document.getElementById("strengthInfo");
const historyTable = document.getElementById("history");
const batchOutput = document.getElementById("batchOutput");
const batchCount = document.getElementById("batchCount");

/* ======================
   CHARACTER POOLS
====================== */
const POOLS = {
  upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
  lower: "abcdefghijklmnopqrstuvwxyz",
  numbers: "0123456789",
  symbols: "!@#$%^&*()-_=+[]{};:,.<>?"
};

const activePools = new Set(Object.keys(POOLS));

document.querySelectorAll(".toggle").forEach(el => {
  el.addEventListener("click", () => {
    el.classList.toggle("active");
    const k = el.dataset.set;
    activePools.has(k) ? activePools.delete(k) : activePools.add(k);
    generateSingle();
  });
});

/* ======================
   SECURE RNG
====================== */
function rand(max) {
  const a = new Uint32Array(1);
  crypto.getRandomValues(a);
  return a[0] % max;
}

/* ======================
   PASSWORD GENERATION
====================== */
function generatePassword(len) {
  let chars = "";
  activePools.forEach(p => chars += POOLS[p]);
  if (!chars) return "";

  let out = "";
  for (let i = 0; i < len; i++) {
    out += chars[rand(chars.length)];
  }
  return out;
}

/* ======================
   ENTROPY & STRENGTH
====================== */
function entropy(pool, len) {
  return Math.round(len * Math.log2(pool));
}

function crackTime(bits) {
  const s = Math.pow(2, bits) / 1e10;
  if (s < 60) return `${s.toFixed(1)}s`;
  if (s < 3600) return `${(s/60).toFixed(1)}m`;
  if (s < 86400) return `${(s/3600).toFixed(1)}h`;
  if (s < 31536000) return `${(s/86400).toFixed(1)}d`;
  return `${(s/31536000).toFixed(1)}y`;
}

function updateStrength(pwd) {
  let poolSize = 0;
  activePools.forEach(p => poolSize += POOLS[p].length);

  const bits = entropy(poolSize, pwd.length);
  strengthBar.style.width = Math.min(bits, 100) + "%";
  strengthBar.style.background =
    bits > 80 ? "var(--ok)" :
    bits > 50 ? "var(--warn)" : "var(--bad)";

  strengthInfo.textContent = `Entropy: ${bits} bits ¬∑ Crack time ‚âà ${crackTime(bits)}`;
}

/* ======================
   ACTIONS
====================== */
function generateSingle() {
  const pwd = generatePassword(+lengthInput.value);
  passwordOutput.textContent = pwd;
  updateStrength(pwd);
  addHistory(pwd);
}

function generateBatch() {
  batchOutput.textContent = "";
  for (let i = 0; i < +batchCount.value; i++) {
    const pwd = generatePassword(+lengthInput.value);
    batchOutput.textContent += pwd + "\n";
    addHistory(pwd);
  }
}

function copyPassword() {
  navigator.clipboard.writeText(passwordOutput.textContent);
  alert("Password copied to clipboard!");
}

function addHistory(pwd) {
    if(!pwd) return;
  const row = historyTable.insertRow(1);
  row.insertCell(0).textContent = new Date().toLocaleString();
  row.insertCell(1).textContent = pwd;

  if (historyTable.rows.length > 4) {
    historyTable.deleteRow(4);
  }

  saveHistory();
}

function saveHistory() {
    const rows = Array.from(historyTable.rows).slice(1);
    const history = rows.map(row => ({
        timestamp: row.cells[0].textContent,
        password: row.cells[1].textContent
    }));
    localStorage.setItem("passwordHistory", JSON.stringify(history));
}

function loadHistory() {

    const history = JSON.parse(localStorage.getItem("passwordHistory"));

    if (history) {

        history.slice(0, 3).forEach(item => {

            const row = historyTable.insertRow(1);

            row.insertCell(0).textContent = item.timestamp;

            row.insertCell(1).textContent = item.password;

        });

    }

}

function exportVault() {
    const history = localStorage.getItem("passwordHistory");
    const blob = new Blob([history], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "password_vault.json";
    a.click();
    URL.revokeObjectURL(url);
}

function savePassword() {
    const password = passwordOutput.textContent;
    if (!password) {
        alert("Please generate a password first.");
        return;
    }
    const history = JSON.parse(localStorage.getItem("passwordHistory")) || [];
    const exists = history.some(item => item.password === password);
    if (exists) {
        alert("Password already saved.");
        return;
    }
    addHistory(password);
    alert("Password saved to history.");
}

/* ======================
   EVENT BINDING
====================== */
document.getElementById("generateBtn").onclick = generateSingle;
document.getElementById("batchBtn").onclick = generateBatch;
document.getElementById("copyBtn").onclick = copyPassword;
document.getElementById("saveBtn").onclick = savePassword;
document.getElementById("exportBtn").onclick = exportVault;

lengthInput.oninput = () => {
    lenVal.textContent = lengthInput.value;
    generateSingle();
};

/* ======================
   INIT
====================== */
loadTheme();
loadHistory();
generateSingle();
</script>

</body>
</html>
